<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>subscriptions | @algorandfoundation/algokit-subscriber</title><meta name="description" content="Documentation for @algorandfoundation/algokit-subscriber"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">@algorandfoundation/algokit-subscriber</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">subscriptions</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="" class="tsd-anchor-link"><code>getSubscribedTransactions</code></h1><p><code>getSubscribedTransactions</code> is the core building block at the centre of this library. It's a simple, but flexible mechanism that allows you to enact a single subscription &quot;poll&quot; of the Algorand blockchain.</p>
<p>This is a lower level building block, you likely don't want to use it directly, but instead use the <a href="subscriber.html#creating-a-subscriber"><code>AlgorandSubscriber</code> class</a>.</p>
<p>You can use this method to orchestrate everything from an index of all relevant data from the start of the chain through to simply subscribing to relevant transactions as they emerge at the tip of the chain. It allows you to have reliable at least once delivery even if your code has outages through the use of watermarking.</p>
<pre><code class="typescript"><span class="hl-1">/**</span><br/><span class="hl-1"> * Executes a single pull/poll to subscribe to transactions on the configured Algorand</span><br/><span class="hl-1"> * blockchain for the given subscription context.</span><br/><span class="hl-1"> * </span><span class="hl-2">@param</span><span class="hl-1"> </span><span class="hl-3">subscription</span><span class="hl-1"> The subscription context.</span><br/><span class="hl-1"> * </span><span class="hl-2">@param</span><span class="hl-1"> </span><span class="hl-3">algod</span><span class="hl-1"> An Algod client.</span><br/><span class="hl-1"> * </span><span class="hl-2">@param</span><span class="hl-1"> </span><span class="hl-3">indexer</span><span class="hl-1"> An optional indexer client, only needed when `onMaxRounds` is `catchup-with-indexer`.</span><br/><span class="hl-1"> * </span><span class="hl-2">@returns</span><span class="hl-1"> The result of this subscription pull/poll.</span><br/><span class="hl-1"> */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-2">function</span><span class="hl-0"> </span><span class="hl-4">getSubscribedTransactions</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-3">subscription</span><span class="hl-0">: </span><span class="hl-6">TransactionSubscriptionParams</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-3">algod</span><span class="hl-0">: </span><span class="hl-6">Algodv2</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-3">indexer</span><span class="hl-0">?: </span><span class="hl-6">Indexer</span><span class="hl-0">,</span><br/><span class="hl-0">): </span><span class="hl-6">Promise</span><span class="hl-0">&lt;</span><span class="hl-6">TransactionSubscriptionResult</span><span class="hl-0">&gt;</span>
</code><button type="button">Copy</button></pre>

<h2 id="transactionsubscriptionparams" class="tsd-anchor-link">TransactionSubscriptionParams<a href="#transactionsubscriptionparams" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Specifying a subscription requires passing in a <code>TransactionSubscriptionParams</code> object, which configures the behaviour:</p>
<pre><code class="typescript"><span class="hl-1">/** Parameters to control a single subscription pull/poll. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">TransactionSubscriptionParams</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The filter(s) to apply to find transactions of interest.</span><br/><span class="hl-1">   * A list of filters with corresponding names.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * </span><span class="hl-2">@example</span><br/><span class="hl-1">   * ```typescript</span><br/><span class="hl-1">   *  filter: [{</span><br/><span class="hl-1">   *   name: &#39;asset-transfers&#39;,</span><br/><span class="hl-1">   *   filter: {</span><br/><span class="hl-1">   *     type: TransactionType.axfer,</span><br/><span class="hl-1">   *     //...</span><br/><span class="hl-1">   *   }</span><br/><span class="hl-1">   *  }, {</span><br/><span class="hl-1">   *   name: &#39;payments&#39;,</span><br/><span class="hl-1">   *   filter: {</span><br/><span class="hl-1">   *     type: TransactionType.pay,</span><br/><span class="hl-1">   *     //...</span><br/><span class="hl-1">   *   }</span><br/><span class="hl-1">   *  }]</span><br/><span class="hl-1">   * ```</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   */</span><br/><span class="hl-0">  </span><span class="hl-3">filters</span><span class="hl-0">: </span><span class="hl-6">NamedTransactionFilter</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** Any ARC-28 event definitions to process from app call logs */</span><br/><span class="hl-0">  </span><span class="hl-3">arc28Events</span><span class="hl-0">?: </span><span class="hl-6">Arc28EventGroup</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The current round watermark that transactions have previously been synced to.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Persist this value as you process transactions processed from this method</span><br/><span class="hl-1">   * to allow for resilient and incremental syncing.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Syncing will start from `watermark + 1`.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Start from 0 if you want to start from the beginning of time, noting that</span><br/><span class="hl-1">   * will be slow if `onMaxRounds` is `sync-oldest`.</span><br/><span class="hl-1">   **/</span><br/><span class="hl-0">  </span><span class="hl-3">watermark</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** The maximum number of rounds to sync for each subscription pull/poll.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Defaults to 500.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * This gives you control over how many rounds you wait for at a time,</span><br/><span class="hl-1">   * your staleness tolerance when using `skip-sync-newest` or `fail`, and</span><br/><span class="hl-1">   * your catchup speed when using `sync-oldest`.</span><br/><span class="hl-1">   **/</span><br/><span class="hl-0">  </span><span class="hl-3">maxRoundsToSync</span><span class="hl-0">?: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/**</span><br/><span class="hl-1">   * The maximum number of rounds to sync from indexer when using `syncBehaviour: &#39;catchup-with-indexer&#39;.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * By default there is no limit and it will paginate through all of the rounds.</span><br/><span class="hl-1">   * Sometimes this can result in an incredibly long catchup time that may break the service</span><br/><span class="hl-1">   * due to execution and memory constraints, particularly for filters that result in a large number of transactions.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Instead, this allows indexer catchup to be split into multiple polls, each with a transactionally consistent</span><br/><span class="hl-1">   * boundary based on the number of rounds specified here.</span><br/><span class="hl-1">   */</span><br/><span class="hl-0">  </span><span class="hl-3">maxIndexerRoundsToSync</span><span class="hl-0">?: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/** If the current tip of the configured Algorand blockchain is more than `maxRoundsToSync`</span><br/><span class="hl-1">   * past `watermark` then how should that be handled:</span><br/><span class="hl-1">   *  * `skip-sync-newest`: Discard old blocks/transactions and sync the newest; useful</span><br/><span class="hl-1">   *    for real-time notification scenarios where you don&#39;t care about history and</span><br/><span class="hl-1">   *    are happy to lose old transactions.</span><br/><span class="hl-1">   *  * `sync-oldest`: Sync from the oldest rounds forward `maxRoundsToSync` rounds</span><br/><span class="hl-1">   *    using algod; note: this will be slow if you are starting from 0 and requires</span><br/><span class="hl-1">   *    an archival node.</span><br/><span class="hl-1">   *  * `sync-oldest-start-now`: Same as `sync-oldest`, but if the `watermark` is `0`</span><br/><span class="hl-1">   *    then start at the current round i.e. don&#39;t sync historical records, but once</span><br/><span class="hl-1">   *    subscribing starts sync everything; note: if it falls behind it requires an</span><br/><span class="hl-1">   *    archival node.</span><br/><span class="hl-1">   *  * `catchup-with-indexer`: Sync to round `currentRound - maxRoundsToSync + 1`</span><br/><span class="hl-1">   *    using indexer (much faster than using algod for long time periods) and then</span><br/><span class="hl-1">   *    use algod from there.</span><br/><span class="hl-1">   *  * `fail`: Throw an error.</span><br/><span class="hl-1">   **/</span><br/><span class="hl-0">  </span><span class="hl-3">syncBehaviour</span><span class="hl-0">: </span><span class="hl-7">&#39;skip-sync-newest&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;sync-oldest&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;sync-oldest-start-now&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;catchup-with-indexer&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;fail&#39;</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="transactionfilter" class="tsd-anchor-link">TransactionFilter<a href="#transactionfilter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <a href="#transactionsubscriptionparams"><code>filters</code> parameter</a> allows you to specify a set of filters to return a subset of transactions you are interested in. Each filter contains a <code>filter</code> property of type <code>TransactionFilter</code>, which matches the following type:</p>
<pre><code class="typescript"><span class="hl-1">/** Common parameters to control a single subscription pull/poll for both `AlgorandSubscriber` and `getSubscribedTransactions`. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">CoreTransactionSubscriptionParams</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The filter(s) to apply to find transactions of interest.</span><br/><span class="hl-1">   * A list of filters with corresponding names.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * </span><span class="hl-2">@example</span><br/><span class="hl-1">   * ```typescript</span><br/><span class="hl-1">   *  filter: [{</span><br/><span class="hl-1">   *   name: &#39;asset-transfers&#39;,</span><br/><span class="hl-1">   *   filter: {</span><br/><span class="hl-1">   *     type: TransactionType.axfer,</span><br/><span class="hl-1">   *     //...</span><br/><span class="hl-1">   *   }</span><br/><span class="hl-1">   *  }, {</span><br/><span class="hl-1">   *   name: &#39;payments&#39;,</span><br/><span class="hl-1">   *   filter: {</span><br/><span class="hl-1">   *     type: TransactionType.pay,</span><br/><span class="hl-1">   *     //...</span><br/><span class="hl-1">   *   }</span><br/><span class="hl-1">   *  }]</span><br/><span class="hl-1">   * ```</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   */</span><br/><span class="hl-0">  </span><span class="hl-3">filters</span><span class="hl-0">: </span><span class="hl-6">NamedTransactionFilter</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** Any ARC-28 event definitions to process from app call logs */</span><br/><span class="hl-0">  </span><span class="hl-3">arc28Events</span><span class="hl-0">?: </span><span class="hl-6">Arc28EventGroup</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The maximum number of rounds to sync from algod for each subscription pull/poll.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Defaults to 500.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * This gives you control over how many rounds you wait for at a time,</span><br/><span class="hl-1">   * your staleness tolerance when using `skip-sync-newest` or `fail`, and</span><br/><span class="hl-1">   * your catchup speed when using `sync-oldest`.</span><br/><span class="hl-1">   **/</span><br/><span class="hl-0">  </span><span class="hl-3">maxRoundsToSync</span><span class="hl-0">?: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/**</span><br/><span class="hl-1">   * The maximum number of rounds to sync from indexer when using `syncBehaviour: &#39;catchup-with-indexer&#39;.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * By default there is no limit and it will paginate through all of the rounds.</span><br/><span class="hl-1">   * Sometimes this can result in an incredibly long catchup time that may break the service</span><br/><span class="hl-1">   * due to execution and memory constraints, particularly for filters that result in a large number of transactions.</span><br/><span class="hl-1">   *</span><br/><span class="hl-1">   * Instead, this allows indexer catchup to be split into multiple polls, each with a transactionally consistent</span><br/><span class="hl-1">   * boundary based on the number of rounds specified here.</span><br/><span class="hl-1">   */</span><br/><span class="hl-0">  </span><span class="hl-3">maxIndexerRoundsToSync</span><span class="hl-0">?: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/** If the current tip of the configured Algorand blockchain is more than `maxRoundsToSync`</span><br/><span class="hl-1">   * past `watermark` then how should that be handled:</span><br/><span class="hl-1">   *  * `skip-sync-newest`: Discard old blocks/transactions and sync the newest; useful</span><br/><span class="hl-1">   *    for real-time notification scenarios where you don&#39;t care about history and</span><br/><span class="hl-1">   *    are happy to lose old transactions.</span><br/><span class="hl-1">   *  * `sync-oldest`: Sync from the oldest rounds forward `maxRoundsToSync` rounds</span><br/><span class="hl-1">   *    using algod; note: this will be slow if you are starting from 0 and requires</span><br/><span class="hl-1">   *    an archival node.</span><br/><span class="hl-1">   *  * `sync-oldest-start-now`: Same as `sync-oldest`, but if the `watermark` is `0`</span><br/><span class="hl-1">   *    then start at the current round i.e. don&#39;t sync historical records, but once</span><br/><span class="hl-1">   *    subscribing starts sync everything; note: if it falls behind it requires an</span><br/><span class="hl-1">   *    archival node.</span><br/><span class="hl-1">   *  * `catchup-with-indexer`: Sync to round `currentRound - maxRoundsToSync + 1`</span><br/><span class="hl-1">   *    using indexer (much faster than using algod for long time periods) and then</span><br/><span class="hl-1">   *    use algod from there.</span><br/><span class="hl-1">   *  * `fail`: Throw an error.</span><br/><span class="hl-1">   **/</span><br/><span class="hl-0">  </span><span class="hl-3">syncBehaviour</span><span class="hl-0">: </span><span class="hl-7">&#39;skip-sync-newest&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;sync-oldest&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;sync-oldest-start-now&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;catchup-with-indexer&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;fail&#39;</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<p>Each filter you provide within this type will apply an AND logic between the specified filters, e.g.</p>
<pre><code class="typescript"><span class="hl-8">filter</span><span class="hl-0">: {</span><br/><span class="hl-0">  </span><span class="hl-8">type</span><span class="hl-0">: </span><span class="hl-3">TransactionType</span><span class="hl-0">.</span><span class="hl-3">axfer</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-8">sender</span><span class="hl-0">: </span><span class="hl-7">&quot;ABC...&quot;</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<p>Will return transactions that are <code>axfer</code> type AND have a sender of <code>&quot;ABC...&quot;</code>.</p>
<h3 id="namedtransactionfilter" class="tsd-anchor-link">NamedTransactionFilter<a href="#namedtransactionfilter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can specify multiple filters in an array, where each filter is a <code>NamedTransactionFilter</code>, which consists of:</p>
<pre><code class="typescript"><span class="hl-1">/** Specify a named filter to apply to find transactions of interest. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">NamedTransactionFilter</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The name to give the filter. */</span><br/><span class="hl-0">  </span><span class="hl-3">name</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The filter itself. */</span><br/><span class="hl-0">  </span><span class="hl-3">filter</span><span class="hl-0">: </span><span class="hl-6">TransactionFilter</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<p>This gives you the ability to detect which filter got matched when a transaction is returned, noting that you can use the same name multiple times if there are multiple filters (aka OR logic) that comprise the same logical filter.</p>
<h2 id="arc28eventgroup" class="tsd-anchor-link">Arc28EventGroup<a href="#arc28eventgroup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <a href="#transactionsubscriptionparams"><code>arc28Events</code> parameter</a> allows you to define any ARC-28 events that may appear in subscribed transactions so they can either be subscribed to, or be processed and added to the resulting <a href="#subscribedtransaction">subscribed transaction object</a>.</p>
<h2 id="transactionsubscriptionresult" class="tsd-anchor-link">TransactionSubscriptionResult<a href="#transactionsubscriptionresult" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The result of calling <code>getSubscribedTransactions</code> is a <code>TransactionSubscriptionResult</code>:</p>
<pre><code class="typescript"><span class="hl-1">/** The result of a single subscription pull/poll. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">TransactionSubscriptionResult</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The round range that was synced from/to */</span><br/><span class="hl-0">  </span><span class="hl-3">syncedRoundRange</span><span class="hl-0">: [</span><span class="hl-8">startRound</span><span class="hl-0">: </span><span class="hl-6">bigint</span><span class="hl-0">, </span><span class="hl-8">endRound</span><span class="hl-0">: </span><span class="hl-6">bigint</span><span class="hl-0">]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The current detected tip of the configured Algorand blockchain. */</span><br/><span class="hl-0">  </span><span class="hl-3">currentRound</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** The watermark value that was retrieved at the start of the subscription poll. */</span><br/><span class="hl-0">  </span><span class="hl-3">startingWatermark</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** The new watermark value to persist for the next call to</span><br/><span class="hl-1">   * `getSubscribedTransactions` to continue the sync.</span><br/><span class="hl-1">   * Will be equal to `syncedRoundRange[1]`. Only persist this</span><br/><span class="hl-1">   * after processing (or in the same atomic transaction as)</span><br/><span class="hl-1">   * subscribed transactions to keep it reliable. */</span><br/><span class="hl-0">  </span><span class="hl-3">newWatermark</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** Any transactions that matched the given filter within</span><br/><span class="hl-1">   * the synced round range. This substantively uses the [indexer transaction</span><br/><span class="hl-1">   * format](hhttps://dev.algorand.co/reference/rest-apis/indexer#transaction)</span><br/><span class="hl-1">   * to represent the data with some additional fields.</span><br/><span class="hl-1">   */</span><br/><span class="hl-0">  </span><span class="hl-3">subscribedTransactions</span><span class="hl-0">: </span><span class="hl-6">SubscribedTransaction</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The metadata about any blocks that were retrieved from algod as part</span><br/><span class="hl-1">   * of the subscription poll.</span><br/><span class="hl-1">   */</span><br/><span class="hl-0">  </span><span class="hl-3">blockMetadata</span><span class="hl-0">?: </span><span class="hl-6">BlockMetadata</span><span class="hl-0">[]</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-1">/** Metadata about a block that was retrieved from algod. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">BlockMetadata</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The base64 block hash. */</span><br/><span class="hl-0">  </span><span class="hl-3">hash</span><span class="hl-0">?: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The round of the block. */</span><br/><span class="hl-0">  </span><span class="hl-3">round</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** Block creation timestamp in seconds since epoch */</span><br/><span class="hl-0">  </span><span class="hl-3">timestamp</span><span class="hl-0">: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/** The genesis ID of the chain. */</span><br/><span class="hl-0">  </span><span class="hl-3">genesisId</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The base64 genesis hash of the chain. */</span><br/><span class="hl-0">  </span><span class="hl-3">genesisHash</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The base64 previous block hash. */</span><br/><span class="hl-0">  </span><span class="hl-3">previousBlockHash</span><span class="hl-0">?: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The base64 seed of the block. */</span><br/><span class="hl-0">  </span><span class="hl-3">seed</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** Fields relating to rewards */</span><br/><span class="hl-0">  </span><span class="hl-3">rewards</span><span class="hl-0">?: </span><span class="hl-6">BlockRewards</span><br/><span class="hl-0">  </span><span class="hl-1">/** Count of parent transactions in this block */</span><br/><span class="hl-0">  </span><span class="hl-3">parentTransactionCount</span><span class="hl-0">: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/** Full count of transactions and inner transactions (recursively) in this block. */</span><br/><span class="hl-0">  </span><span class="hl-3">fullTransactionCount</span><span class="hl-0">: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/** Number of the next transaction that will be committed after this block.  It is 0 when no transactions have ever been committed (since TxnCounter started being supported). */</span><br/><span class="hl-0">  </span><span class="hl-3">txnCounter</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** TransactionsRoot authenticates the set of transactions appearing in the block. More specifically, it&#39;s the root of a merkle tree whose leaves are the block&#39;s Txids, in lexicographic order. For the empty block, it&#39;s 0. Note that the TxnRoot does not authenticate the signatures on the transactions, only the transactions themselves. Two blocks with the same transactions but in a different order and with different signatures will have the same TxnRoot.</span><br/><span class="hl-1">  Pattern : &quot;^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==\|[A-Za-z0-9+/]{3}=)?$&quot; */</span><br/><span class="hl-0">  </span><span class="hl-3">transactionsRoot</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** TransactionsRootSHA256 is an auxiliary TransactionRoot, built using a vector commitment instead of a merkle tree, and SHA256 hash function instead of the default SHA512_256. This commitment can be used on environments where only the SHA256 function exists. */</span><br/><span class="hl-0">  </span><span class="hl-3">transactionsRootSha256</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** Fields relating to a protocol upgrade. */</span><br/><span class="hl-0">  </span><span class="hl-3">upgradeState</span><span class="hl-0">?: </span><span class="hl-6">BlockUpgradeState</span><br/><span class="hl-0">  </span><span class="hl-1">/** Tracks the status of state proofs. */</span><br/><span class="hl-0">  </span><span class="hl-3">stateProofTracking</span><span class="hl-0">?: </span><span class="hl-6">BlockStateProofTracking</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** Fields relating to voting for a protocol upgrade. */</span><br/><span class="hl-0">  </span><span class="hl-3">upgradeVote</span><span class="hl-0">?: </span><span class="hl-6">BlockUpgradeVote</span><br/><span class="hl-0">  </span><span class="hl-1">/** Participation account data that needs to be checked/acted on by the network. */</span><br/><span class="hl-0">  </span><span class="hl-3">participationUpdates</span><span class="hl-0">?: </span><span class="hl-6">ParticipationUpdates</span><br/><span class="hl-0">  </span><span class="hl-1">/** Address of the proposer of this block */</span><br/><span class="hl-0">  </span><span class="hl-3">proposer</span><span class="hl-0">?: </span><span class="hl-6">string</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="subscribedtransaction" class="tsd-anchor-link">SubscribedTransaction<a href="#subscribedtransaction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The common model used to expose a transaction that is returned from a subscription is a <code>SubscribedTransaction</code>, which can be imported like so:</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-0"> </span><span class="hl-5">type</span><span class="hl-0"> { </span><span class="hl-3">SubscribedTransaction</span><span class="hl-0"> } </span><span class="hl-5">from</span><span class="hl-0"> </span><span class="hl-7">&#39;@algorandfoundation/algokit-subscriber/types&#39;</span>
</code><button type="button">Copy</button></pre>

<p>This type is substantively, based on the <code>algosdk.indexerModels.Transaction</code>. While the indexer type is used, the subscriber itself doesn't have to use indexer - any transactions it retrieves from algod are transformed to this common model type. Beyond the indexer type it has some modifications to:</p>
<ul>
<li>Make <code>id</code> required</li>
<li>Add the <code>parentTransactionId</code> field so inner transactions have a reference to their parent</li>
<li>Override the type of <code>innerTxns</code> to be <code>SubscribedTransaction[]</code> so inner transactions (recursively) get these extra fields too</li>
<li>Add emitted ARC-28 events via <code>arc28Events</code></li>
<li>The list of filter(s) that caused the transaction to be matched</li>
<li>The list of balanceChange(s) that occurred in the transaction</li>
</ul>
<p>The definition of the type is:</p>
<pre><code class="typescript"><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">class</span><span class="hl-0"> </span><span class="hl-6">SubscribedTransaction</span><span class="hl-0"> </span><span class="hl-2">extends</span><span class="hl-0"> </span><span class="hl-6">algosdk</span><span class="hl-0">.</span><span class="hl-6">indexerModels</span><span class="hl-0">.</span><span class="hl-6">Transaction</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-3">id</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The intra-round offset of the parent of this transaction (if it&#39;s an inner transaction). */</span><br/><span class="hl-0">  </span><span class="hl-3">parentIntraRoundOffset</span><span class="hl-0">?: </span><span class="hl-6">number</span><br/><span class="hl-0">  </span><span class="hl-1">/** The transaction ID of the parent of this transaction (if it&#39;s an inner transaction). */</span><br/><span class="hl-0">  </span><span class="hl-3">parentTransactionId</span><span class="hl-0">?: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** Inner transactions produced by application execution. */</span><br/><span class="hl-0">  </span><span class="hl-3">innerTxns</span><span class="hl-0">?: </span><span class="hl-6">SubscribedTransaction</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** Any ARC-28 events emitted from an app call. */</span><br/><span class="hl-0">  </span><span class="hl-3">arc28Events</span><span class="hl-0">?: </span><span class="hl-6">EmittedArc28Event</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The names of any filters that matched the given transaction to result in it being &#39;subscribed&#39;. */</span><br/><span class="hl-0">  </span><span class="hl-3">filtersMatched</span><span class="hl-0">?: </span><span class="hl-6">string</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The balance changes in the transaction. */</span><br/><span class="hl-0">  </span><span class="hl-3">balanceChanges</span><span class="hl-0">?: </span><span class="hl-6">BalanceChange</span><span class="hl-0">[]</span><br/><br/><span class="hl-0">  </span><span class="hl-2">constructor</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-3">id</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">parentIntraRoundOffset</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">parentTransactionId</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">innerTxns</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">arc28Events</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">filtersMatched</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">balanceChanges</span><span class="hl-0">,</span><br/><span class="hl-0">    ...</span><span class="hl-3">rest</span><br/><span class="hl-0">  }: </span><span class="hl-6">Omit</span><span class="hl-0">&lt;</span><span class="hl-6">SubscribedTransaction</span><span class="hl-0">, </span><span class="hl-7">&#39;getEncodingSchema&#39;</span><span class="hl-0"> | </span><span class="hl-7">&#39;toEncodingData&#39;</span><span class="hl-0">&gt;) {</span><br/><span class="hl-0">    </span><span class="hl-2">super</span><span class="hl-0">(</span><span class="hl-3">rest</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">id</span><span class="hl-0"> = </span><span class="hl-3">id</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">parentIntraRoundOffset</span><span class="hl-0"> = </span><span class="hl-3">parentIntraRoundOffset</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">parentTransactionId</span><span class="hl-0"> = </span><span class="hl-3">parentTransactionId</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">innerTxns</span><span class="hl-0"> = </span><span class="hl-3">innerTxns</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">arc28Events</span><span class="hl-0"> = </span><span class="hl-3">arc28Events</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">filtersMatched</span><span class="hl-0"> = </span><span class="hl-3">filtersMatched</span><br/><span class="hl-0">    </span><span class="hl-2">this</span><span class="hl-0">.</span><span class="hl-3">balanceChanges</span><span class="hl-0"> = </span><span class="hl-3">balanceChanges</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-1">/** An emitted ARC-28 event extracted from an app call log. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">EmittedArc28Event</span><span class="hl-0"> </span><span class="hl-2">extends</span><span class="hl-0"> </span><span class="hl-6">Arc28EventToProcess</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The ordered arguments extracted from the event that was emitted */</span><br/><span class="hl-0">  </span><span class="hl-3">args</span><span class="hl-0">: </span><span class="hl-6">ABIValue</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-1">/** The named arguments extracted from the event that was emitted (where the arguments had a name defined) */</span><br/><span class="hl-0">  </span><span class="hl-3">argsByName</span><span class="hl-0">: </span><span class="hl-6">Record</span><span class="hl-0">&lt;</span><span class="hl-6">string</span><span class="hl-0">, </span><span class="hl-6">ABIValue</span><span class="hl-0">&gt;</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-1">/** An ARC-28 event to be processed */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">Arc28EventToProcess</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The name of the ARC-28 event group the event belongs to */</span><br/><span class="hl-0">  </span><span class="hl-3">groupName</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The name of the ARC-28 event that was triggered */</span><br/><span class="hl-0">  </span><span class="hl-3">eventName</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The signature of the event e.g. `EventName(type1,type2)` */</span><br/><span class="hl-0">  </span><span class="hl-3">eventSignature</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The 4-byte hex prefix for the event */</span><br/><span class="hl-0">  </span><span class="hl-3">eventPrefix</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The ARC-28 definition of the event */</span><br/><span class="hl-0">  </span><span class="hl-3">eventDefinition</span><span class="hl-0">: </span><span class="hl-6">Arc28Event</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-1">/** Represents a balance change effect for a transaction. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-6">BalanceChange</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** The address that the balance change is for. */</span><br/><span class="hl-0">  </span><span class="hl-3">address</span><span class="hl-0">: </span><span class="hl-6">string</span><br/><span class="hl-0">  </span><span class="hl-1">/** The asset ID of the balance change, or 0 for Algos. */</span><br/><span class="hl-0">  </span><span class="hl-3">assetId</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** The amount of the balance change in smallest divisible unit or microAlgos. */</span><br/><span class="hl-0">  </span><span class="hl-3">amount</span><span class="hl-0">: </span><span class="hl-6">bigint</span><br/><span class="hl-0">  </span><span class="hl-1">/** The roles the account was playing that led to the balance change */</span><br/><span class="hl-0">  </span><span class="hl-3">roles</span><span class="hl-0">: </span><span class="hl-6">BalanceChangeRole</span><span class="hl-0">[]</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-1">/** The role that an account was playing for a given balance change. */</span><br/><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-2">enum</span><span class="hl-0"> </span><span class="hl-6">BalanceChangeRole</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">/** Account was sending a transaction (sending asset and/or spending fee if asset `0`) */</span><br/><span class="hl-0">  </span><span class="hl-9">Sender</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">/** Account was receiving a transaction */</span><br/><span class="hl-0">  </span><span class="hl-9">Receiver</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">/** Account was having an asset amount closed to it */</span><br/><span class="hl-0">  </span><span class="hl-9">CloseTo</span><span class="hl-0">,</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="examples" class="tsd-anchor-link">Examples<a href="#examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here are some examples of how to use this method:</p>
<h3 id="real-time-notification-of-transactions-of-interest-at-the-tip-of-the-chain-discarding-stale-records" class="tsd-anchor-link">Real-time notification of transactions of interest at the tip of the chain discarding stale records<a href="#real-time-notification-of-transactions-of-interest-at-the-tip-of-the-chain-discarding-stale-records" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you ran the following code on a cron schedule of (say) every 5 seconds it would notify you every time the account (in this case the Data History Museum TestNet account <code>ER7AMZRPD5KDVFWTUUVOADSOWM4RQKEEV2EDYRVSA757UHXOIEKGMBQIVU</code>) sent a transaction. If the service stopped working for a period of time and fell behind then
it would drop old records and restart notifications from the new tip.</p>
<pre><code class="typescript"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">algorand</span><span class="hl-0"> = </span><span class="hl-3">AlgorandClient</span><span class="hl-0">.</span><span class="hl-4">defaultLocalNet</span><span class="hl-0">()</span><br/><br/><span class="hl-1">// You would need to implement getLastWatermark() to retrieve from a persistence store</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">watermark</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">getLastWatermark</span><span class="hl-0">()</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">subscription</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">getSubscribedTransactions</span><span class="hl-0">(</span><br/><span class="hl-0">  {</span><br/><span class="hl-0">    </span><span class="hl-3">filters:</span><span class="hl-0"> [</span><br/><span class="hl-0">      {</span><br/><span class="hl-0">        </span><span class="hl-3">name:</span><span class="hl-0"> </span><span class="hl-7">&#39;filter1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-3">filter:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-3">sender:</span><span class="hl-0"> </span><span class="hl-7">&#39;ER7AMZRPD5KDVFWTUUVOADSOWM4RQKEEV2EDYRVSA757UHXOIEKGMBQIVU&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">    ],</span><br/><span class="hl-0">    </span><span class="hl-3">watermark</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">maxRoundsToSync:</span><span class="hl-0"> </span><span class="hl-10">100</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">onMaxRounds:</span><span class="hl-0"> </span><span class="hl-7">&#39;skip-sync-newest&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-3">algorand</span><span class="hl-0">.</span><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-3">algod</span><span class="hl-0">,</span><br/><span class="hl-0">)</span><br/><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">subscribedTransactions</span><span class="hl-0">.</span><span class="hl-3">length</span><span class="hl-0"> &gt; </span><span class="hl-10">0</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-1">// You would need to implement notifyTransactions to action the transactions</span><br/><span class="hl-0">  </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">notifyTransactions</span><span class="hl-0">(</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">subscribedTransactions</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><span class="hl-1">// You would need to implement saveWatermark to persist the watermark to the persistence store</span><br/><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">saveWatermark</span><span class="hl-0">(</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">newWatermark</span><span class="hl-0">)</span>
</code><button type="button">Copy</button></pre>

<h3 id="real-time-notification-of-transactions-of-interest-at-the-tip-of-the-chain-with-at-least-once-delivery" class="tsd-anchor-link">Real-time notification of transactions of interest at the tip of the chain with at least once delivery<a href="#real-time-notification-of-transactions-of-interest-at-the-tip-of-the-chain-with-at-least-once-delivery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you ran the following code on a cron schedule of (say) every 5 seconds it would notify you every time the account (in this case the Data History Museum TestNet account <code>ER7AMZRPD5KDVFWTUUVOADSOWM4RQKEEV2EDYRVSA757UHXOIEKGMBQIVU</code>) sent a transaction. If the service stopped working for a period of time and fell behind then
it would pick up where it left off and catch up using algod (note: you need to connect it to a archival node).</p>
<pre><code class="typescript"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">algorand</span><span class="hl-0"> = </span><span class="hl-3">AlgorandClient</span><span class="hl-0">.</span><span class="hl-4">defaultLocalNet</span><span class="hl-0">()</span><br/><span class="hl-1">// You would need to implement getLastWatermark() to retrieve from a persistence store</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">watermark</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">getLastWatermark</span><span class="hl-0">()</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">subscription</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">getSubscribedTransactions</span><span class="hl-0">(</span><br/><span class="hl-0">  {</span><br/><span class="hl-0">    </span><span class="hl-3">filters:</span><span class="hl-0"> [</span><br/><span class="hl-0">      {</span><br/><span class="hl-0">        </span><span class="hl-3">name:</span><span class="hl-0"> </span><span class="hl-7">&#39;filter1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-3">filter:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-3">sender:</span><span class="hl-0"> </span><span class="hl-7">&#39;ER7AMZRPD5KDVFWTUUVOADSOWM4RQKEEV2EDYRVSA757UHXOIEKGMBQIVU&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">    ],</span><br/><span class="hl-0">    </span><span class="hl-3">watermark</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">maxRoundsToSync:</span><span class="hl-0"> </span><span class="hl-10">100</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">onMaxRounds:</span><span class="hl-0"> </span><span class="hl-7">&#39;sync-oldest-start-now&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-3">algorand</span><span class="hl-0">.</span><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-3">algod</span><span class="hl-0">,</span><br/><span class="hl-0">)</span><br/><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">subscribedTransactions</span><span class="hl-0">.</span><span class="hl-3">length</span><span class="hl-0"> &gt; </span><span class="hl-10">0</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-1">// You would need to implement notifyTransactions to action the transactions</span><br/><span class="hl-0">  </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">notifyTransactions</span><span class="hl-0">(</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">subscribedTransactions</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><span class="hl-1">// You would need to implement saveWatermark to persist the watermark to the persistence store</span><br/><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">saveWatermark</span><span class="hl-0">(</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">newWatermark</span><span class="hl-0">)</span>
</code><button type="button">Copy</button></pre>

<h3 id="quickly-building-a-reliable-up-to-date-cache-index-of-all-transactions-of-interest-from-the-beginning-of-the-chain" class="tsd-anchor-link">Quickly building a reliable, up-to-date cache index of all transactions of interest from the beginning of the chain<a href="#quickly-building-a-reliable-up-to-date-cache-index-of-all-transactions-of-interest-from-the-beginning-of-the-chain" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you ran the following code on a cron schedule of (say) every 30 - 60 seconds it would create a cached index of all assets created by the account (in this case the Data History Museum TestNet account <code>ER7AMZRPD5KDVFWTUUVOADSOWM4RQKEEV2EDYRVSA757UHXOIEKGMBQIVU</code>). Given it uses indexer to catch up you can deploy this into a fresh environment with an empty database and it will catch up in seconds rather than days.</p>
<pre><code class="typescript"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">algorand</span><span class="hl-0"> = </span><span class="hl-3">AlgorandClient</span><span class="hl-0">.</span><span class="hl-4">defaultLocalNet</span><span class="hl-0">()</span><br/><span class="hl-1">// You would need to implement getLastWatermark() to retrieve from a persistence store</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">watermark</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">getLastWatermark</span><span class="hl-0">()</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-9">subscription</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">getSubscribedTransactions</span><span class="hl-0">(</span><br/><span class="hl-0">  {</span><br/><span class="hl-0">    </span><span class="hl-3">filters:</span><span class="hl-0"> [</span><br/><span class="hl-0">      {</span><br/><span class="hl-0">        </span><span class="hl-3">name:</span><span class="hl-0"> </span><span class="hl-7">&#39;filter1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-3">filter:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-3">TransactionType</span><span class="hl-0">.</span><span class="hl-3">acfg</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-3">sender:</span><span class="hl-0"> </span><span class="hl-7">&#39;ER7AMZRPD5KDVFWTUUVOADSOWM4RQKEEV2EDYRVSA757UHXOIEKGMBQIVU&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-3">assetCreate:</span><span class="hl-0"> </span><span class="hl-2">true</span><span class="hl-0">,</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">    ],</span><br/><span class="hl-0">    </span><span class="hl-3">watermark</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">maxRoundsToSync:</span><span class="hl-0"> </span><span class="hl-10">1000</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-3">onMaxRounds:</span><span class="hl-0"> </span><span class="hl-7">&#39;catchup-with-indexer&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-3">algorand</span><span class="hl-0">.</span><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-3">algod</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-3">algorand</span><span class="hl-0">.</span><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-3">indexer</span><span class="hl-0">,</span><br/><span class="hl-0">)</span><br/><br/><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">subscribedTransactions</span><span class="hl-0">.</span><span class="hl-3">length</span><span class="hl-0"> &gt; </span><span class="hl-10">0</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-1">// You would need to implement saveTransactions to persist the transactions</span><br/><span class="hl-0">  </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">saveTransactions</span><span class="hl-0">(</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">subscribedTransactions</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><span class="hl-1">// You would need to implement saveWatermark to persist the watermark to the persistence store</span><br/><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-4">saveWatermark</span><span class="hl-0">(</span><span class="hl-3">subscription</span><span class="hl-0">.</span><span class="hl-3">newWatermark</span><span class="hl-0">)</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#"><span></span></a><ul><li><a href="#transactionsubscriptionparams"><span>Transaction<wbr/>Subscription<wbr/>Params</span></a></li><li><a href="#transactionfilter"><span>Transaction<wbr/>Filter</span></a></li><li><ul><li><a href="#namedtransactionfilter"><span>Named<wbr/>Transaction<wbr/>Filter</span></a></li></ul></li><li><a href="#arc28eventgroup"><span>Arc28<wbr/>Event<wbr/>Group</span></a></li><li><a href="#transactionsubscriptionresult"><span>Transaction<wbr/>Subscription<wbr/>Result</span></a></li><li><a href="#subscribedtransaction"><span>Subscribed<wbr/>Transaction</span></a></li><li><a href="#examples"><span>Examples</span></a></li><li><ul><li><a href="#real-time-notification-of-transactions-of-interest-at-the-tip-of-the-chain-discarding-stale-records"><span>Real-<wbr/>time notification of transactions of interest at the tip of the chain discarding stale records</span></a></li><li><a href="#real-time-notification-of-transactions-of-interest-at-the-tip-of-the-chain-with-at-least-once-delivery"><span>Real-<wbr/>time notification of transactions of interest at the tip of the chain with at least once delivery</span></a></li><li><a href="#quickly-building-a-reliable-up-to-date-cache-index-of-all-transactions-of-interest-from-the-beginning-of-the-chain"><span>Quickly building a reliable, up-<wbr/>to-<wbr/>date cache index of all transactions of interest from the beginning of the chain</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">@algorandfoundation/algokit-subscriber</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
